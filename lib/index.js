var L=Object.defineProperty,$=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var P=(o,t,e)=>t in o?L(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,N=(o,t)=>{for(var e in t||(t={}))F.call(t,e)&&P(o,e,t[e]);if(A)for(var e of A(t))G.call(t,e)&&P(o,e,t[e]);return o},S=(o,t)=>$(o,j(t)),K=o=>L(o,"__esModule",{value:!0});var g=(o,t)=>{var e={};for(var r in o)F.call(o,r)&&t.indexOf(r)<0&&(e[r]=o[r]);if(o!=null&&A)for(var r of A(o))t.indexOf(r)<0&&G.call(o,r)&&(e[r]=o[r]);return e};var M=(o,t)=>{K(o);for(var e in t)L(o,e,{get:t[e],enumerable:!0})};M(exports,{BehaviorTree:()=>U,BehaviorTreeImporter:()=>O,BranchNode:()=>h,Decorator:()=>u,FAILURE:()=>c,Introspector:()=>_,Node:()=>f,RUNNING:()=>s,Random:()=>T,SUCCESS:()=>d,Selector:()=>B,Sequence:()=>w,Task:()=>y,decorators:()=>v,default:()=>V,getRegistry:()=>q,registryLookUp:()=>C});var s=Symbol("running"),d=!0,c=!1;var z=()=>!1,H=()=>{},Q=()=>{},f=class{constructor(p){this.nodeType="Node";var n=p,{run:t=z,start:e=H,end:r=Q}=n,a=g(n,["run","start","end"]);this.blueprint=N({run:t,start:e,end:r},a)}run(t,n={}){var i=n,{introspector:e,rerun:r=!1,registryLookUp:a=l=>l}=i,p=g(i,["introspector","rerun","registryLookUp"]);r||this.blueprint.start(t);let l=this.blueprint.run(t,S(N({},p),{rerun:r,registryLookUp:a}));return l!==s&&this.blueprint.end(t),e&&e.push(this,l,t),l}get name(){return this._name||this.blueprint.name}set name(t){this._name=t}};var y=class extends f{constructor(){super(...arguments);this.nodeType="Task"}};var E={};function q(){return E}function C(o){if(typeof o=="string"){let t=E[o];if(!t)throw new Error(`No node with name ${o} registered.`);return t}return o}var U=class{constructor({tree:t,blackboard:e}){this.tree=t,this.blackboard=e,this.lastResult=null}step({introspector:t}={}){let e=this.lastResult&&typeof this.lastResult=="object"?this.lastResult:[],r=this.lastResult===s||e.length>0;t&&t.start(this),this.lastResult=C(this.tree).run(this.blackboard,{indexes:e,introspector:t,rerun:r,registryLookUp:C}),t&&t.end()}static register(t,e){E[t]=typeof e=="function"?new y({name:t,run:e}):e}static cleanRegistry(){E={}}};var v={};M(v,{AlwaysFailDecorator:()=>b,AlwaysSucceedDecorator:()=>k,CooldownDecorator:()=>x,InvertDecorator:()=>D,LoopDecorator:()=>I});var u=class extends f{constructor(r={config:{}}){var a=r,{config:t={}}=a,e=g(a,["config"]);super(e);this.nodeType="Decorator";this.setConfig(t)}decorate(t,e,r){return t(t,e,r)}run(t,n={}){var i=n,{introspector:e,rerun:r,registryLookUp:a=l=>l}=i,p=g(i,["introspector","rerun","registryLookUp"]);r||this.blueprint.start(t);let l=0,m=this.decorate(()=>(++l,a(this.blueprint.node).run(t,S(N({},p),{rerun:r,introspector:e,registryLookUp:a}))),t,this.config);return m!==s&&this.blueprint.end(t),e&&e.wrapLast(l,this,m,t),m}setConfig(t){this.config=t}};var b=class extends u{constructor(){super(...arguments);this.nodeType="AlwaysFailDecorator"}decorate(t){return t()===s?s:c}};var k=class extends u{constructor(){super(...arguments);this.nodeType="AlwaysSucceedDecorator"}decorate(t){return t()===s?s:d}};var x=class extends u{constructor(){super(...arguments);this.lock=!1;this.nodeType="CooldownDecorator"}setConfig({cooldown:t=5}){this.config={cooldown:t}}decorate(t){return this.lock?c:(this.lock=!0,setTimeout(()=>{this.lock=!1},this.config.cooldown*1e3),t())}};var D=class extends u{constructor(){super(...arguments);this.nodeType="InvertDecorator"}decorate(t){let e=t();return e===s?s:e===d?c:d}};var I=class extends u{constructor(){super(...arguments);this.nodeType="LoopDecorator"}setConfig({loop:t=1/0}){this.config={loop:t}}decorate(t){let e=0,r=c;for(;e++<this.config.loop;)if(r=t(),r===c)return c;return r}};var h=class extends f{constructor(t){super(t);this.OPT_OUT_CASE=d;this.START_CASE=d;this.nodeType="BranchNode";this.nodes=t.nodes||[],this.numNodes=this.nodes.length,this.wasRunning=!1}run(t={},{indexes:e=[],introspector:r,rerun:a,registryLookUp:p=n=>n}={}){a||this.blueprint.start(t);let n=this.START_CASE,i=e.shift()||0;for(;i<this.numNodes;){let R=p(this.nodes[i]).run(t,{indexes:e,introspector:r,rerun:a,registryLookUp:p});if(R===s){this.wasRunning=!0,n=[i,...e];break}else if(typeof R=="object"){n=[...e,i,...R];break}else if(R===this.OPT_OUT_CASE){n=R;break}else this.wasRunning=!1,a=!1,++i}let l=n===s||typeof n=="object";if(l||this.blueprint.end(t),r){let m=l?s:n;r.wrapLast(Math.min(i+1,this.numNodes),this,m,t)}return n}};var T=class extends h{constructor(){super(...arguments);this.nodeType="Random"}run(t={},{indexes:e=[],introspector:r,rerun:a,registryLookUp:p=n=>n}={}){a||this.blueprint.start(t);let n=e.shift()||0;a||(n=Math.floor(Math.random()*this.numNodes));let l=p(this.nodes[n]).run(t,{indexes:e,introspector:r,rerun:a,registryLookUp:p}),m=l;l===s?m=[n,...e]:typeof l=="object"&&(m=[...e,n,...l]);let R=m===s||typeof m=="object";if(R||this.blueprint.end(t),r){let J=R?s:m;r.wrapLast(1,this,J,t)}return m}};var B=class extends h{constructor(){super(...arguments);this.nodeType="Selector";this.START_CASE=c;this.OPT_OUT_CASE=d}};var w=class extends h{constructor(){super(...arguments);this.nodeType="Sequence";this.START_CASE=d;this.OPT_OUT_CASE=c}};var O=class{constructor(){this.types={task:y,decorator:u,selector:B,sequence:w,random:T,invert:D,fail:b,succeed:k,cooldown:x,loop:I}}defineType(t,e){this.types[t]=e}parse(t){let n=t,{type:e,name:r}=n,a=g(n,["type","name"]),p=this.types[e];if(!p){let i=C(e);if(i)return i.name=r,i;throw new Error(`Don't know how to handle type ${e}. Please register this first.`)}return new p({name:r,node:t.node?this.parse(t.node):null,nodes:t.nodes?t.nodes.map(i=>this.parse(i)):null,config:a})}};var _=class{constructor(){this.currentResult=[],this.results=[]}start(t){this.tree=t,this.currentResult=[]}end(){let t=this.currentResult.pop();t&&this.results.push(t),delete this.tree,this.currentResult=[]}push(t,e,r){this.currentResult.push(this._toResult(t,e,r))}wrapLast(t,e,r,a){let p=this.currentResult.splice(this.currentResult.length-t,t);this.currentResult.push(S(N({},this._toResult(e,r,a)),{children:p}))}_toResult(t,e,r){return S(N({},t.name?{name:t.name}:{}),{result:e})}reset(){this.results=[]}get lastResult(){return this.results.length===0?null:this.results[this.results.length-1]}};var V=U;0&&(module.exports={BehaviorTree,BehaviorTreeImporter,BranchNode,Decorator,FAILURE,Introspector,Node,RUNNING,Random,SUCCESS,Selector,Sequence,Task,decorators,getRegistry,registryLookUp});
//# sourceMappingURL=index.js.map
